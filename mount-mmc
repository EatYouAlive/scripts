#!/bin/bash
#
#  ░▒▓████████▓▒░▒▓███████▓▒░░▒▓███████▓▒░ ░▒▓██████▓▒░░▒▓███████▓▒░       ░▒▓████████▓▒░▒▓█▓▒░▒▓███████▓▒░  
#  ░▒▓█▓▒░      ░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░      ░▒▓█▓▒░      ░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░ 
#  ░▒▓█▓▒░      ░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░      ░▒▓█▓▒░      ░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░ 
#  ░▒▓██████▓▒░ ░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░▒▓███████▓▒░       ░▒▓██████▓▒░ ░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░ 
#  ░▒▓█▓▒░      ░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░      ░▒▓█▓▒░      ░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░ 
#  ░▒▓█▓▒░      ░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░      ░▒▓█▓▒░      ░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░ 
#  ░▒▓████████▓▒░▒▓█▓▒░░▒▓█▓▒░▒▓███████▓▒░ ░▒▓██████▓▒░░▒▓█▓▒░░▒▓█▓▒░      ░▒▓█▓▒░      ░▒▓█▓▒░▒▓█▓▒░░▒▓█▓▒░ 
#                                                                                                            
# Year: 2025.

############################################################################################################
#tput setaf 0 = black
#tput setaf 1 = red
#tput setaf 2 = green
#tput setaf 3 = yellow
#tput setaf 4 = dark blue
#tput setaf 5 = purple
#tput setaf 6 = cyan
#tput setaf 7 = gray
#tput setaf 8 = light blue

#end colors
#tput sgr0
############################################################################################################

# This script is specifically for mounting the music microSD used in my car.

# --- Configuration Settings ---
DEVICE=""             # Name of the device to mount (e.g., /dev/sdb1)
MOUNT_POINT="/home/endorfin/EXT-DEV/USB" # Fixed mount point
FILESYSTEM_TYPE=""    # Type of the filesystem (e.g., vfat, ntfs-3g, ext4)

# --- Functions ---

# Displays usage instructions
usage() {
  echo "Usage: $0 [-d <device>] [-t <filesystem_type>]"
  echo "  -d <device>          Path to the device to mount (e.g., /dev/sdb1)"
  echo "  -t <filesystem_type> Filesystem type (e.g., vfat, ntfs-3g, ext4)"
  exit 1
}

# Checks if the specified device exists
check_device() {
  if [ ! -b "$DEVICE" ]; then
    echo "Error: The specified device ('$DEVICE') does not exist or is not a block device."
    exit 1
  fi
}

# Checks if the mount point exists, and creates it if not
check_mount_point() {
  if [ ! -d "$MOUNT_POINT" ]; then
    echo "Warning: The mount point ('$MOUNT_POINT') does not exist. Creating it."
    sudo mkdir -p "$MOUNT_POINT"
    if [ ! -d "$MOUNT_POINT" ]; then
      echo "Error: Failed to create the mount point ('$MOUNT_POINT')."
      exit 1
    fi
  fi
}

# Mounts the device with the specified parameters
mount_device() {
  local mount_options="uid=$(id -u),gid=$(id -g),umask=022,noatime"
  if [ -n "$FILESYSTEM_TYPE" ]; then
    sudo mount -t "$FILESYSTEM_TYPE" -o "$mount_options" "$DEVICE" "$MOUNT_POINT"
  else
    sudo mount -o "$mount_options" "$DEVICE" "$MOUNT_POINT"
  fi

  if [ $? -eq 0 ]; then
    echo "Successfully mounted: '$DEVICE' -> '$MOUNT_POINT'"
  else
    echo "Error: Failed to mount: '$DEVICE' to '$MOUNT_POINT'."
    exit 1
  fi
}

# --- Main Script Part ---

# Process arguments
while getopts "d:t:" opt; do
  case "$opt" in
    d) DEVICE="$OPTARG" ;;
    t) FILESYSTEM_TYPE="$OPTARG" ;;
    \?) usage ;; # Handle invalid options
  esac
done

# Check if the mandatory device parameter was provided
if [ -z "$DEVICE" ]; then
  echo "Error: Please specify the device (-d)."
  usage
fi

# Check the mount point
check_mount_point

# Check the device
check_device

# Mount the device
mount_device

exit 0
